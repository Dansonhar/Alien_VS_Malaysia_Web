<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Teh Tarik Toss - Aliens vs Malaysians</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(180deg, #F5DEB3 0%, #DEB887 100%);
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        #gameCanvas {
            display: block;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            background: rgba(0, 0, 0, 0.75);
        }

        .screen.hidden {
            display: none;
        }

        .screen h1 {
            font-size: 3rem;
            color: #D2691E;
            text-shadow: 0 5px 0 #333;
            margin-bottom: 1rem;
        }

        .screen p {
            font-size: 1.3rem;
            color: #fff;
            margin-bottom: 2rem;
        }

        .screen button {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8rem;
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 50px;
            background: #8B4513;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 6px 0 #654321;
        }

        .screen button:active {
            transform: translateY(3px);
            box-shadow: 0 3px 0 #654321;
        }

        #hud {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 1.5rem;
            color: #333;
            z-index: 5;
        }

        #timer {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            color: #8B4513;
            z-index: 5;
        }

        .back-btn {
            position: fixed;
            top: 15px;
            left: 15px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.2rem;
            padding: 12px 24px;
            border: 4px solid #000;
            border-radius: 12px;
            background: #FF5252;
            color: #fff;
            cursor: pointer;
            z-index: 999;
            box-shadow: 4px 4px 0 #000;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .back-btn:hover {
            transform: translateY(2px);
            box-shadow: 2px 2px 0 #000;
        }

        #finalScore {
            font-size: 4rem;
            color: #D2691E;
        }

        /* Responsive UI */
        @media (max-width: 480px) {
            .screen h1 {
                font-size: 2rem;
            }

            .screen p {
                font-size: 1rem;
            }

            .screen button {
                font-size: 1.2rem;
                padding: 0.8rem 2rem;
            }

            #hud,
            #timer {
                font-size: 1.1rem;
                top: 10px;
            }

            #hud {
                left: 10px;
            }

            #timer {
                right: 10px;
            }

            .back-btn {
                font-size: 0.7rem;
                padding: 0.3rem 0.6rem;
            }

            #finalScore {
                font-size: 2.5rem;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .screen h1 {
                font-size: 2.5rem;
            }

            .screen button {
                font-size: 1.5rem;
            }

            #finalScore {
                font-size: 3rem;
            }
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas"></canvas>

    <div id="hud" class="hidden">Served: <span id="score">0</span></div>
    <div id="timer" class="hidden">45</div>

    <div id="startScreen" class="screen">
        <h1>‚òï TEH TARIK TOSS</h1>
        <p>Fill their cups! They just want breakfast!</p>
        <button id="startBtn">TAP TO START</button>
    </div>

    <div id="endScreen" class="screen hidden">
        <h1>TIME'S UP!</h1>
        <p>Aliens served:</p>
        <div id="finalScore">0</div>
        <button id="restartBtn">PLAY AGAIN</button>
    </div>

    <button class="back-btn" onclick="window.location.href='../'"><span>üè†</span> BACK TO MENU</button>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        let score = 0;
        let timeLeft = 45;
        let gameRunning = false;
        let timerInterval = null;
        let teaDrops = [];
        let aliens = [];
        let effects = [];

        // Teapot position (bottom left)
        const teapot = { x: 80, y: 0, spoutX: 120, spoutY: 0 };

        class TeaDrop {
            constructor(x, y, vx, vy) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.size = 8 + Math.random() * 4;
                this.alive = true;
            }
            draw() {
                ctx.fillStyle = '#8B4513';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.4; // Gravity
                if (this.y > canvas.height + 20) this.alive = false;
            }
        }

        class FloatingAlien {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = canvas.width + 50;
                this.y = 100 + Math.random() * (canvas.height * 0.5);
                this.speed = 1 + Math.random() * 1.5;
                this.size = 50;
                this.mugFill = 0; // 0-100
                this.served = false;
                this.happy = false;
                this.hue = Math.floor(Math.random() * 360);
                this.floatOffset = Math.random() * Math.PI * 2;
            }
            draw() {
                const floatY = this.y + Math.sin(Date.now() / 500 + this.floatOffset) * 10;

                ctx.save();
                ctx.translate(this.x, floatY);

                // Alien body
                ctx.fillStyle = this.happy ? '#FFD700' : `hsl(${this.hue}, 60%, 55%)`;
                ctx.beginPath();
                ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2);
                ctx.fill();

                // Eyes
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(-10, -8, 10, 0, Math.PI * 2);
                ctx.arc(10, -8, 10, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(-10, -8, 5, 0, Math.PI * 2);
                ctx.arc(10, -8, 5, 0, Math.PI * 2);
                ctx.fill();

                // Mouth
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                if (this.happy) {
                    ctx.beginPath();
                    ctx.arc(0, 5, 12, 0, Math.PI);
                    ctx.stroke();
                } else {
                    ctx.beginPath();
                    ctx.arc(0, 10, 6, 0, Math.PI);
                    ctx.stroke();
                }

                // Mug (below alien)
                const mugY = this.size / 2 + 20;
                ctx.fillStyle = '#FFF';
                ctx.fillRect(-20, mugY, 40, 35);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.strokeRect(-20, mugY, 40, 35);

                // Handle
                ctx.beginPath();
                ctx.arc(25, mugY + 17, 10, -Math.PI / 2, Math.PI / 2);
                ctx.stroke();

                // Tea fill
                if (this.mugFill > 0) {
                    const fillHeight = (this.mugFill / 100) * 30;
                    ctx.fillStyle = '#8B4513';
                    ctx.fillRect(-18, mugY + 33 - fillHeight, 36, fillHeight);
                }

                ctx.restore();
            }
            update() {
                if (this.served) return;
                this.x -= this.speed;
                if (this.x < -60) {
                    this.reset();
                }
            }
            getMugBounds() {
                const floatY = this.y + Math.sin(Date.now() / 500 + this.floatOffset) * 10;
                return {
                    x: this.x - 20,
                    y: floatY + this.size / 2 + 20,
                    width: 40,
                    height: 35
                };
            }
        }

        class Effect {
            constructor(x, y, text) {
                this.x = x;
                this.y = y;
                this.text = text;
                this.life = 1;
            }
            draw() {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.font = 'bold 1.5rem Fredoka';
                ctx.fillStyle = '#FFD700';
                ctx.textAlign = 'center';
                ctx.fillText(this.text, this.x, this.y - (1 - this.life) * 30);
                ctx.restore();
            }
            update() {
                this.life -= 0.03;
            }
        }

        function spawnAlien() {
            if (aliens.length < 4) {
                aliens.push(new FloatingAlien());
            }
        }

        function drawTeapot() {
            teapot.y = canvas.height - 100;
            teapot.spoutY = teapot.y - 30;

            ctx.save();
            ctx.translate(teapot.x, teapot.y);

            // Body
            ctx.fillStyle = '#C0C0C0';
            ctx.beginPath();
            ctx.ellipse(0, 0, 50, 40, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Spout
            ctx.fillStyle = '#C0C0C0';
            ctx.beginPath();
            ctx.moveTo(30, -10);
            ctx.lineTo(60, -40);
            ctx.lineTo(70, -35);
            ctx.lineTo(45, 0);
            ctx.fill();
            ctx.stroke();

            // Handle
            ctx.beginPath();
            ctx.arc(-50, 0, 20, Math.PI / 2, -Math.PI / 2, true);
            ctx.stroke();

            // Lid
            ctx.fillStyle = '#999';
            ctx.beginPath();
            ctx.ellipse(0, -35, 25, 10, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            // Lid knob
            ctx.beginPath();
            ctx.arc(0, -45, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            ctx.restore();
        }

        function pour() {
            // Create tea drops from spout
            const spoutX = teapot.x + 65;
            const spoutY = teapot.y - 38;

            for (let i = 0; i < 3; i++) {
                const angle = -Math.PI / 4 + (Math.random() - 0.5) * 0.3;
                const speed = 8 + Math.random() * 3;
                teaDrops.push(new TeaDrop(
                    spoutX,
                    spoutY,
                    Math.cos(angle) * speed,
                    Math.sin(angle) * speed
                ));
            }
        }

        function gameLoop() {
            if (!gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Background - mamak stall hint
            ctx.fillStyle = '#A0522D';
            ctx.fillRect(0, canvas.height - 40, canvas.width, 40);

            // Draw teapot
            drawTeapot();

            // isPouring logic removed

            // Update and draw tea drops
            teaDrops = teaDrops.filter(d => d.alive);
            teaDrops.forEach(d => {
                d.update();
                d.draw();

                // Check collision with alien mugs
                aliens.forEach(a => {
                    if (a.served) return;
                    const mug = a.getMugBounds();
                    if (d.x > mug.x && d.x < mug.x + mug.width &&
                        d.y > mug.y && d.y < mug.y + mug.height) {
                        a.mugFill += 25; // Fill chunks per hit
                        d.alive = false;

                        if (a.mugFill >= 100 && !a.served) {
                            a.served = true;
                            a.happy = true;
                            score++;
                            document.getElementById('score').textContent = score;
                            effects.push(new Effect(a.x, a.y, 'Terima Kasih!'));

                            // Remove after animation
                            setTimeout(() => {
                                const idx = aliens.indexOf(a);
                                if (idx > -1) aliens.splice(idx, 1);
                            }, 1000);
                        }
                    }
                });
            });

            // Update and draw aliens
            aliens.forEach(a => {
                a.update();
                a.draw();
            });

            // Effects
            effects = effects.filter(e => e.life > 0);
            effects.forEach(e => { e.update(); e.draw(); });

            requestAnimationFrame(gameLoop);
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        function handleInput(e) {
            if (!gameRunning) return;
            e.preventDefault();

            const pos = getPos(e);
            const spoutX = teapot.x + 65;
            const spoutY = teapot.y - 38;

            const dx = pos.x - spoutX;
            const dy = pos.y - spoutY;
            const angle = Math.atan2(dy, dx);
            const baseSpeed = 22;

            // Spawn a burst of drops
            for (let i = 0; i < 8; i++) {
                const spread = (Math.random() - 0.5) * 0.3;
                const speedVar = (Math.random() - 0.5) * 5;

                teaDrops.push(new TeaDrop(
                    spoutX,
                    spoutY,
                    Math.cos(angle + spread) * (baseSpeed + speedVar),
                    Math.sin(angle + spread) * (baseSpeed + speedVar)
                ));
            }
        }

        canvas.addEventListener('pointerdown', handleInput);

        function startGame() {
            score = 0;
            timeLeft = 45;
            gameRunning = true;
            aliens = [];
            teaDrops = [];
            effects = [];

            document.getElementById('score').textContent = score;
            document.getElementById('timer').textContent = timeLeft;
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('endScreen').classList.add('hidden');
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('timer').classList.remove('hidden');

            // Spawn initial aliens
            for (let i = 0; i < 3; i++) {
                const a = new FloatingAlien();
                a.x = canvas.width * 0.4 + i * 150;
                aliens.push(a);
            }

            // Spawn more over time
            setInterval(() => {
                if (gameRunning) spawnAlien();
            }, 2000);

            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);

            gameLoop();
        }

        function endGame() {
            gameRunning = false;
            clearInterval(timerInterval);
            document.getElementById('hud').classList.add('hidden');
            document.getElementById('timer').classList.add('hidden');
            document.getElementById('finalScore').textContent = score;
            document.getElementById('endScreen').classList.remove('hidden');
        }

        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', startGame);
    </script>
</body>

</html>