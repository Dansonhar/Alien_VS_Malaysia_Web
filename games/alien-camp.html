<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Alien Camp 3D - Aliens vs Malaysians</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'fredoka': ['Fredoka', 'sans-serif'] },
                    colors: { 'sambal': '#FF5252', 'durian': '#FFD600', 'pandan': '#00E676' }
                }
            }
        }
    </script>
    <style>
        .hit-marker {
            position: fixed;
            pointer-events: none;
            font-size: 40px;
            font-weight: bold;
            color: #00E676;
            animation: hitPop 0.3s ease-out forwards;
            z-index: 200;
        }

        @keyframes hitPop {
            0% {
                transform: scale(0.5);
                opacity: 1;
            }

            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 50;
        }
    </style>
</head>

<body class="font-fredoka bg-black overflow-hidden touch-none select-none">

    <!-- HUD -->
    <div id="hud" class="hidden fixed inset-0 pointer-events-none z-50">
        <div class="absolute top-4 left-4 flex flex-col gap-2">
            <div class="bg-black/50 px-4 py-2 rounded-lg border-2 border-white text-white font-bold text-xl">
                SCORE: <span id="score" class="text-pandan">0</span>
            </div>
            <div class="bg-black/50 px-4 py-2 rounded-lg border-2 border-white text-white font-bold text-xl">
                WAVE: <span id="wave" class="text-durian">1</span>
            </div>
        </div>

        <div class="absolute bottom-8 left-1/2 -translate-x-1/2 w-4/5 md:w-1/2">
            <div class="text-white font-bold text-center mb-2">SHIELD INTEGRITY</div>
            <div class="w-full h-6 bg-gray-800 border-2 border-white rounded-full overflow-hidden">
                <div id="healthBar" class="w-full h-full bg-cyan-500 transition-all duration-200"></div>
            </div>
        </div>
    </div>

    <!-- Crosshair -->
    <div id="crosshair" class="hidden">
        <div class="absolute top-1/2 left-0 w-full h-[2px] bg-white/50"></div>
        <div class="absolute left-1/2 top-0 h-full w-[2px] bg-white/50"></div>
    </div>

    <!-- 3D Canvas -->
    <div id="container" class="block w-full h-screen"></div>

    <!-- Main Menu -->
    <div id="mainMenu"
        class="fixed inset-0 bg-black/90 flex flex-col items-center justify-center z-[100] text-center px-4">
        <h1 class="text-5xl md:text-7xl font-bold text-sambal drop-shadow-[0_0_15px_rgba(255,82,82,0.8)] mb-2">
            ALIEN CAMP 3D
        </h1>
        <p class="text-cyan-400 text-xl mb-8 tracking-widest">DEFEND THE OUTPOST</p>

        <button onclick="startGame()"
            class="bg-pandan text-black font-bold text-2xl px-12 py-4 rounded-full border-4 border-white shadow-[0_0_20px_rgba(0,230,118,0.6)] hover:scale-105 active:scale-95 transition-all mb-4">
            START DEFENSE
        </button>

        <p class="text-gray-400 mt-4 text-sm">TAP TO SHOOT â€¢ PROTECT THE BORDER</p>
    </div>

    <!-- End Screen -->
    <div id="endScreen"
        class="hidden fixed inset-0 bg-red-900/80 flex flex-col items-center justify-center z-[100] text-center px-4">
        <h1 class="text-6xl font-bold text-white mb-4 drop-shadow-xl">PERIMETER BREACHED</h1>

        <p class="text-white text-2xl mb-2">Aliens Eliminated:</p>
        <div id="finalScore" class="text-7xl font-bold text-durian mb-8">0</div>

        <button onclick="startGame()"
            class="bg-white text-black font-bold text-2xl px-12 py-4 rounded-full border-4 border-black hover:scale-105 active:scale-95 transition-all">
            RETRY MISSION
        </button>
        <button onclick="window.location.href='../'"
            class="mt-6 bg-gray-800 text-white font-bold px-8 py-3 rounded-full border-2 border-white hover:bg-gray-700">
            ABORT MISSION
        </button>
    </div>

    <button onclick="window.location.href='../'"
        class="fixed bottom-4 left-4 z-[200] bg-white/10 hover:bg-white/20 text-white font-bold px-4 py-2 rounded-lg border border-white/50 backdrop-blur-sm transition-all flex items-center gap-2">
        <span>ðŸ”™</span> EXIT
    </button>

    <script>
        // Game State
        let gameRunning = false;
        let score = 0;
        let wave = 1;
        let health = 100;
        let aliens = [];
        let projectiles = [];
        let particles = [];
        let lastTime = 0;
        let spawnTimer = 0;

        // Three.js Globals
        let scene, camera, renderer, raycaster;
        const pointer = new THREE.Vector2();

        // Setup Three.js
        function initThree() {
            const container = document.getElementById('container');

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050510);
            scene.fog = new THREE.FogExp2(0x050510, 0.008);

            // Camera (FPS view)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 5); // Player height

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            container.appendChild(renderer.domElement);

            // Lights
            const ambient = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambient);

            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(5, 10, 7);
            scene.add(dirLight);

            // Ground (Grid)
            const grid = new THREE.GridHelper(200, 50, 0x00E676, 0x1a1a40);
            grid.position.y = -2; // Below eye level
            scene.add(grid);

            // Starfield
            const starGeo = new THREE.BufferGeometry();
            const starCount = 1000;
            const posArray = new Float32Array(starCount * 3);
            for (let i = 0; i < starCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 500;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const starMat = new THREE.PointsMaterial({ size: 0.5, color: 0xffffff });
            const stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);

            // Raycaster
            raycaster = new THREE.Raycaster();

            // Event Listeners
            window.addEventListener('resize', onWindowResize);
            document.addEventListener('pointerdown', onPointerDown);

            animate(0);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function startGame() {
            // Reset State
            gameRunning = true;
            score = 0;
            wave = 1;
            health = 100;

            // Clear existing entities
            aliens.forEach(a => scene.remove(a.mesh));
            projectiles.forEach(p => scene.remove(p.mesh));
            particles.forEach(p => scene.remove(p.mesh));
            aliens = [];
            projectiles = [];
            particles = [];

            // UI
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('endScreen').classList.add('hidden');
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('crosshair').classList.remove('hidden');

            updateUI();
        }

        function spawnAlien() {
            // Random start position in distance
            const x = (Math.random() - 0.5) * 40;
            const z = -60 - Math.random() * 20; // Start far away

            // Geometry - Combine shapes for "Alien" look
            const group = new THREE.Group();

            // Core
            const geo = new THREE.IcosahedronGeometry(1.5, 0);
            const mat = new THREE.MeshStandardMaterial({
                color: 0x00E676,
                emissive: 0x004400,
                roughness: 0.2,
                metalness: 0.8
            });
            const body = new THREE.Mesh(geo, mat);
            group.add(body);

            // Rings/Spikes
            const ringGeo = new THREE.TorusGeometry(2, 0.1, 8, 20);
            const ringMat = new THREE.MeshBasicMaterial({ color: 0xff00ff });
            const ring = new THREE.Mesh(ringGeo, ringMat);
            ring.rotation.x = Math.PI / 2;
            group.add(ring);

            group.position.set(x, 0, z);

            scene.add(group);

            aliens.push({
                mesh: group,
                speed: 10 + (wave * 2), // Faster each wave
                hp: 1, // One shot kill for arcade feel (or increase)
                wobble: Math.random() * Math.PI
            });
        }

        function shoot(x, y) {
            // Muzzle flash sound or visual could go here

            // Raycast for aim
            pointer.x = (x / window.innerWidth) * 2 - 1;
            pointer.y = -(y / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(pointer, camera);

            // Create projectile visual
            const geo = new THREE.SphereGeometry(0.3, 8, 8);
            const mat = new THREE.MeshBasicMaterial({ color: 0x00ffff });
            const mesh = new THREE.Mesh(geo, mat);

            // Start at camera, fly along ray
            const origin = new THREE.Vector3(0, 1.4, 3); // Slightly in front of camera
            mesh.position.copy(origin);

            // Get direction
            const direction = new THREE.Vector3();
            raycaster.ray.direction.clone(direction);

            scene.add(mesh);
            projectiles.push({
                mesh: mesh,
                velocity: direction.multiplyScalar(100), // Fast bullet
                life: 2 // Seconds alive
            });

            // Screen flash
            const flash = document.createElement('div');
            flash.className = 'fixed inset-0 bg-cyan-500/20 pointer-events-none z-[60]';
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 50);
        }

        function createExplosion(pos) {
            const particleCount = 15;
            const geo = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            const mat = new THREE.MeshBasicMaterial({ color: 0xFF5252 });

            for (let i = 0; i < particleCount; i++) {
                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.copy(pos);

                // Random velocity
                const vel = new THREE.Vector3(
                    (Math.random() - 0.5) * 10,
                    (Math.random() - 0.5) * 10,
                    (Math.random() - 0.5) * 10
                );

                scene.add(mesh);
                particles.push({
                    mesh: mesh,
                    velocity: vel,
                    life: 1.0
                });
            }
        }

        function onPointerDown(event) {
            if (!gameRunning) return;
            shoot(event.clientX, event.clientY);
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('wave').textContent = wave;
            document.getElementById('healthBar').style.width = health + '%';

            if (health < 30) {
                document.getElementById('healthBar').className = "w-full h-full bg-red-600 transition-all duration-200";
            } else {
                document.getElementById('healthBar').className = "w-full h-full bg-cyan-500 transition-all duration-200";
            }
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('hud').classList.add('hidden');
            document.getElementById('crosshair').classList.add('hidden');
            document.getElementById('endScreen').classList.remove('hidden');
            document.getElementById('finalScore').textContent = score;
        }

        // Main Loop
        function animate(time) {
            requestAnimationFrame(animate);

            const dt = (time - lastTime) / 1000;
            lastTime = time;

            if (!gameRunning) {
                // Idle animation in menu
                if (scene) scene.rotation.y += 0.001;
                renderer.render(scene, camera);
                return;
            }

            // Spawning
            spawnTimer -= dt;
            if (spawnTimer <= 0) {
                spawnAlien();
                spawnTimer = Math.max(0.5, 2.0 - (wave * 0.1)); // Spawn faster each wave
            }

            // Update Aliens
            for (let i = aliens.length - 1; i >= 0; i--) {
                const a = aliens[i];
                a.mesh.position.z += a.speed * dt;

                // Wobble
                a.wobble += dt * 5;
                a.mesh.position.y = Math.sin(a.wobble) * 2;
                a.mesh.rotation.z += dt;
                a.mesh.rotation.x += dt;

                // Reached player?
                if (a.mesh.position.z > 5) {
                    health -= 10;
                    updateUI();

                    // Shake camera
                    camera.position.x = (Math.random() - 0.5) * 0.5;

                    scene.remove(a.mesh);
                    aliens.splice(i, 1);

                    if (health <= 0) gameOver();
                    continue;
                }
            }

            // Dampen Camera Shake
            camera.position.x += (0 - camera.position.x) * 0.1;

            // Update Projectiles
            for (let i = projectiles.length - 1; i >= 0; i--) {
                const p = projectiles[i];
                p.mesh.position.add(p.velocity.clone().multiplyScalar(dt));
                p.life -= dt;

                let hit = false;

                // Collision Check (Simple Distance)
                for (let j = aliens.length - 1; j >= 0; j--) {
                    const a = aliens[j];
                    if (p.mesh.position.distanceTo(a.mesh.position) < 2.5) {
                        // HIT!
                        createExplosion(a.mesh.position);
                        score += 100;
                        if (score % 1000 === 0) wave++;
                        updateUI();

                        // Show hit marker at screen pos
                        const vector = a.mesh.position.clone();
                        vector.project(camera);
                        const x = (vector.x * .5 + .5) * window.innerWidth;
                        const y = (-(vector.y * .5) + .5) * window.innerHeight;

                        const marker = document.createElement('div');
                        marker.className = 'hit-marker';
                        marker.textContent = '+100';
                        marker.style.left = x + 'px';
                        marker.style.top = y + 'px';
                        document.body.appendChild(marker);
                        setTimeout(() => marker.remove(), 500);

                        scene.remove(a.mesh);
                        aliens.splice(j, 1);
                        hit = true;
                        break;
                    }
                }

                if (hit || p.life <= 0) {
                    scene.remove(p.mesh);
                    projectiles.splice(i, 1);
                }
            }

            // Update Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.mesh.position.add(p.velocity.clone().multiplyScalar(dt));
                p.mesh.rotation.x += dt * 5;
                p.life -= dt * 2;
                p.mesh.scale.setScalar(p.life);

                if (p.life <= 0) {
                    scene.remove(p.mesh);
                    particles.splice(i, 1);
                }
            }

            renderer.render(scene, camera);
        }

        // Initialize
        initThree();

    </script>
</body>

</html>