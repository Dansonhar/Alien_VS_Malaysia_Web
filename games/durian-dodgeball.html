<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Durian Dodgeball - Aliens vs Malaysians</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { 'fredoka': ['Fredoka', 'sans-serif'] },
          colors: { 'sambal': '#FF5252', 'durian': '#FFD600', 'pandan': '#00E676' }
        }
      }
    }
  </script>
</head>

<body
  class="font-fredoka bg-gradient-to-b from-sky-300 to-green-300 min-h-screen overflow-hidden touch-none select-none">

  <!-- HUD -->
  <!-- HUD -->
  <div id="hud" class="hidden fixed top-4 left-1/2 -translate-x-1/2 z-50 flex gap-4 pointer-events-none">
    <div class="bg-white/90 px-4 py-2 rounded-full border-4 border-black shadow-[4px_4px_0_#000] font-bold text-lg">
      SCORE: <span id="score" class="text-pandan">0</span>
    </div>
    <div class="bg-white/90 px-4 py-2 rounded-full border-4 border-black shadow-[4px_4px_0_#000] font-bold text-lg">
      <span id="timer" class="text-sambal">60</span>s
    </div>
  </div>

  <canvas id="gameCanvas" class="block mx-auto w-full h-screen"></canvas>

  <!-- Start Screen -->
  <div id="startScreen"
    class="fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-[100] text-center px-4">
    <h1 class="text-5xl md:text-6xl font-bold text-yellow-400 drop-shadow-[0_6px_0_#333] mb-4">
      ü•ù DURIAN DODGEBALL
    </h1>
    <p class="text-white text-2xl mb-8">Throw the King of Fruits at surprised aliens!</p>
    <button id="startBtn"
      class="bg-red-500 text-white font-bold text-2xl px-12 py-4 rounded-full shadow-[0_8px_0_#C0392B] hover:-translate-y-1 active:translate-y-1 active:shadow-[0_4px_0_#C0392B] transition-all">
      TAP TO START
    </button>
  </div>

  <!-- End Screen -->
  <div id="endScreen"
    class="hidden fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-[100] text-center px-4">
    <h1 class="text-5xl md:text-6xl font-bold text-yellow-400 drop-shadow-[0_6px_0_#333] mb-4">
      TIME'S UP!
    </h1>
    <p class="text-white text-2xl mb-4">Aliens hit:</p>
    <div id="finalScore" class="text-7xl font-bold text-teal-400 drop-shadow-[0_4px_0_#333] mb-8">0</div>
    <button id="restartBtn"
      class="bg-red-500 text-white font-bold text-2xl px-12 py-4 rounded-full shadow-[0_8px_0_#C0392B] hover:-translate-y-1 active:translate-y-1 active:shadow-[0_4px_0_#C0392B] transition-all">
      PLAY AGAIN
    </button>
    <button onclick="window.location.href='../'"
      class="mt-4 bg-gray-600 text-white font-bold px-6 py-2 rounded-full border-2 border-black">
      BACK TO MENU
    </button>
  </div>

  <button onclick="window.location.href='../'"
    class="fixed bottom-4 left-4 z-[200] bg-red-500 hover:bg-red-600 text-white font-bold px-6 py-3 rounded-xl border-4 border-black shadow-[4px_4px_0_#000] hover:shadow-[2px_2px_0_#000] hover:translate-y-[2px] transition-all flex items-center gap-2">
    <span class="text-2xl">üè†</span> BACK TO MENU
  </button>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let width, height;

    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    let score = 0;
    let timeLeft = 60;
    let gameRunning = false;
    let durian = null;
    let aliens = [];
    let effects = [];
    let timerInterval = null;

    const durianSpawn = () => ({ x: width / 2, y: height - 100 });

    class Alien {
      constructor() {
        this.reset();
        this.y = Math.random() * (height * 0.5) + 50;
      }
      reset() {
        this.x = Math.random() * (width - 100) + 50;
        this.y = Math.random() * (height * 0.4) + 50;
        this.size = 60 + Math.random() * 30;
        this.visible = true;
        this.expression = 'normal';
        this.wobble = 0;
        this.hue = Math.floor(Math.random() * 360);
      }
      draw() {
        if (!this.visible) return;
        ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(Math.sin(this.wobble) * 0.1);

        ctx.fillStyle = `hsl(${this.hue}, 70%, 60%)`;
        ctx.beginPath(); ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2); ctx.fill();

        const eyeOffset = this.size / 5;
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(-eyeOffset, -5, this.size / 6, 0, Math.PI * 2);
        ctx.arc(eyeOffset, -5, this.size / 6, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = '#000';
        const pupilX = this.expression === 'dizzy' ? Math.sin(this.wobble * 5) * 3 : 0;
        ctx.beginPath();
        ctx.arc(-eyeOffset + pupilX, -5, this.size / 12, 0, Math.PI * 2);
        ctx.arc(eyeOffset + pupilX, -5, this.size / 12, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = '#000'; ctx.lineWidth = 3; ctx.beginPath();
        if (this.expression === 'shocked') ctx.arc(0, 10, this.size / 6, 0, Math.PI * 2);
        else if (this.expression === 'dizzy') { ctx.moveTo(-10, 15); ctx.lineTo(10, 10); }
        else ctx.arc(0, 5, this.size / 5, 0, Math.PI);
        ctx.stroke();

        ctx.strokeStyle = `hsl(${this.hue}, 70%, 50%)`; ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(-10, -this.size / 2); ctx.lineTo(-15, -this.size / 2 - 20);
        ctx.moveTo(10, -this.size / 2); ctx.lineTo(15, -this.size / 2 - 20); ctx.stroke();

        ctx.fillStyle = `hsl(${this.hue}, 90%, 70%)`;
        ctx.beginPath();
        ctx.arc(-15, -this.size / 2 - 20, 6, 0, Math.PI * 2);
        ctx.arc(15, -this.size / 2 - 20, 6, 0, Math.PI * 2);
        ctx.fill();

        ctx.restore();
      }
      update() { if (this.expression !== 'normal') this.wobble += 0.3; }
    }

    class Durian {
      constructor(x, y) {
        this.x = x; this.y = y; this.vx = 0; this.vy = 0;
        this.size = 50; this.rotation = 0; this.thrown = false;
      }
      draw() {
        ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.rotation);
        ctx.fillStyle = '#9ACD32'; ctx.beginPath(); ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = '#6B8E23';
        for (let i = 0; i < 12; i++) {
          const angle = (i / 12) * Math.PI * 2;
          ctx.beginPath();
          ctx.moveTo(Math.cos(angle) * this.size * 0.4, Math.sin(angle) * this.size * 0.4);
          ctx.lineTo(Math.cos(angle) * this.size * 0.6, Math.sin(angle) * this.size * 0.6);
          ctx.lineTo(Math.cos(angle + 0.2) * this.size * 0.4, Math.sin(angle + 0.2) * this.size * 0.4);
          ctx.fill();
        }
        ctx.fillStyle = '#FFD700'; ctx.beginPath(); ctx.arc(0, 0, this.size / 4, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(-6, -3, 4, 0, Math.PI * 2); ctx.arc(6, -3, 4, 0, Math.PI * 2); ctx.fill();
        ctx.beginPath(); ctx.arc(0, 5, 6, 0, Math.PI); ctx.stroke();
        ctx.restore();
      }
      update() {
        if (this.thrown) {
          this.x += this.vx; this.y += this.vy;
          this.vy += 0.3; this.rotation += 0.15;
        }
      }
    }

    class Effect {
      constructor(x, y, type) {
        this.x = x; this.y = y; this.type = type; this.life = 1; this.size = 30;
      }
      draw() {
        ctx.save(); ctx.globalAlpha = this.life; ctx.translate(this.x, this.y);
        if (this.type === 'stink') {
          ctx.fillStyle = '#90EE90';
          for (let i = 0; i < 5; i++) {
            const offset = (1 - this.life) * 30;
            ctx.beginPath(); ctx.arc(Math.cos(i * 1.2) * offset, Math.sin(i * 1.2) * offset - offset, 10 + (1 - this.life) * 20, 0, Math.PI * 2); ctx.fill();
          }
        } else {
          ctx.fillStyle = '#FFD700';
          for (let i = 0; i < 6; i++) {
            const angle = (i / 6) * Math.PI * 2; const dist = (1 - this.life) * 50;
            ctx.beginPath(); ctx.arc(Math.cos(angle) * dist, Math.sin(angle) * dist, 8, 0, Math.PI * 2); ctx.fill();
          }
        }
        ctx.restore();
      }
      update() { this.life -= 0.02; }
    }

    function checkCollision(d, a) {
      const dx = d.x - a.x; const dy = d.y - a.y;
      return Math.sqrt(dx * dx + dy * dy) < (d.size / 2 + a.size / 2);
    }

    function gameLoop() {
      if (!gameRunning) return;
      ctx.clearRect(0, 0, width, height);

      ctx.fillStyle = '#8B4513'; ctx.fillRect(50, height - 150, 120, 100);
      ctx.fillStyle = '#A0522D'; ctx.beginPath(); ctx.moveTo(50, height - 150); ctx.lineTo(110, height - 200); ctx.lineTo(170, height - 150); ctx.fill();
      ctx.fillStyle = '#8B4513'; ctx.fillRect(width - 170, height - 130, 100, 80);
      ctx.fillStyle = '#A0522D'; ctx.beginPath(); ctx.moveTo(width - 170, height - 130); ctx.lineTo(width - 120, height - 170); ctx.lineTo(width - 70, height - 130); ctx.fill();
      ctx.fillStyle = '#228B22'; ctx.fillRect(0, height - 50, width, 50);

      aliens.forEach(a => { a.update(); a.draw(); });

      if (durian) {
        durian.update(); durian.draw();
        if (durian.thrown) {
          aliens.forEach(a => {
            if (a.visible && checkCollision(durian, a)) {
              a.expression = 'shocked'; a.visible = false; score++;
              document.getElementById('score').textContent = score;
              effects.push(new Effect(a.x, a.y, 'hit'));
              setTimeout(() => { a.reset(); }, 1500);
            }
          });
          if (durian.y > height + 50 || durian.x < -50 || durian.x > width + 50 || durian.y < -50) {
            effects.push(new Effect(durian.x, Math.min(durian.y, height - 50), 'stink'));
            if (gameRunning) durian = new Durian(durianSpawn().x, durianSpawn().y);
          }
        }
      }

      effects = effects.filter(e => e.life > 0);
      effects.forEach(e => { e.update(); e.draw(); });

      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener('pointerdown', (e) => {
      if (!gameRunning || !durian || durian.thrown) return;
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const cx = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
      const cy = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

      const dx = cx - durian.x; const dy = cy - durian.y;
      const angle = Math.atan2(dy, dx);
      const speed = 25;
      durian.vx = Math.cos(angle) * speed; durian.vy = Math.sin(angle) * speed;
      durian.thrown = true;

      durian.thrown = true;
    });

    function startGame() {
      score = 0; timeLeft = 60; gameRunning = true;
      document.getElementById('score').textContent = score;
      document.getElementById('timer').textContent = timeLeft;
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('endScreen').classList.add('hidden');
      document.getElementById('hud').classList.remove('hidden');

      aliens = []; for (let i = 0; i < 5; i++) aliens.push(new Alien());
      durian = new Durian(durianSpawn().x, durianSpawn().y);
      effects = [];

      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--; document.getElementById('timer').textContent = timeLeft;
        if (timeLeft <= 0) endGame();
      }, 1000);
      requestAnimationFrame(gameLoop);
    }

    function endGame() {
      gameRunning = false; clearInterval(timerInterval);
      document.getElementById('hud').classList.add('hidden');
      document.getElementById('finalScore').textContent = score;
      document.getElementById('endScreen').classList.remove('hidden');
    }

    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('restartBtn').addEventListener('click', startGame);
  </script>
</body>

</html>